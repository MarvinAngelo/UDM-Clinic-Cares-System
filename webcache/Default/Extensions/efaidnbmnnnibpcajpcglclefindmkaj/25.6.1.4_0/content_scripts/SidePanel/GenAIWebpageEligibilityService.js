/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
class GenAIWebpageEligibilityService{static THIRTY_DAYS=2592e6;static isReadable=null;static shouldShow=null;static isEdgeBrowser(){return navigator.userAgentData?navigator.userAgentData.brands.some((t=>"Microsoft Edge"===t.brand)):navigator.userAgent.includes("Edg/")}static async isPopupOrApp(){const t=await chrome.runtime.sendMessage({type:"getWindowType"}),{isPopup:e,isApp:i}=t;return e||i}static reset(){this.isReadable=null,this.shouldShow=null}static trackDomain(t,e){window.dcLocalStorage.getItem("allDomainTracking")&&chrome.runtime.sendMessage({main_op:"log-info",log:{message:t,domain:e}})}static async fetchExplicitBlockList(t){const e=await fetch(t);if(!e.ok)throw new Error(`Failed to fetch block list from ${t}: ${e.statusText}`);return(await e.text()).split("\n").map((t=>t.trim())).filter((t=>t.length>0))}static async getExplicitBlockList(){let t=[];try{const e=new CacheStore("explicit-blocklist");if(t=await e.getWithTTL("explicitBlockList"),t&&t.length>0)return t;t=await this.fetchExplicitBlockList("https://acrobat.adobe.com/dc-hosted-extension/block.txt"),t&&t.length>0&&await e.setWithTTL("explicitBlockList",t,this.THIRTY_DAYS)}catch(t){chrome.runtime.sendMessage({main_op:"log-error",log:{message:"Error fetching explicit block list from Adobe",error:t.toString()}})}return t}static isSupportedLanguage(t){return["en-US","en-GB"].includes(t)||t.startsWith("en")}static async _shouldShowTouchpoints(){if(this.isEdgeBrowser())return!1;await initDcLocalStorage();if(!window.dcLocalStorage.getItem("sidePanelRegistered"))return!1;const t=chrome.runtime.getURL(""),e=window.location.href,i=new URL(e).hostname;if(document.contentType&&document.contentType.includes("application/pdf"))return this.trackDomain("Page Disqualified - Webpage is a PDF",i),!1;if(await this.isPopupOrApp())return this.trackDomain("Page Disqualified - Webpage is in a popup or app",i),!1;const a=window.dcLocalStorage.getItem("appLocale")||chrome.i18n.getMessage("@@ui_locale");if(!this.isSupportedLanguage(a))return this.trackDomain("Page Disqualified - Unsupported language",i),!1;if(e.startsWith(t)||GENAI_WEBPAGE_BLOCKLIST.find((t=>e.includes(t))))return this.trackDomain("Page Disqualified - Webpage is in the blocklist",i),!1;const s=window.dcLocalStorage.getItem("hideFabDomainList")||[];if((window.dcLocalStorage.getItem("genaiWebpageBlockList")||[]).includes(i))return this.trackDomain("Page Disqualified - Webpage is in the floodgate blocklist",i),!1;if(s.includes(i))return this.trackDomain("Page Disqualified - Webpage is in the user blocklist",i),!1;const o=await this.isCurrentWebPageReadable();return this.trackDomain(o?"Page Qualified - Webpage is readable":"Page Disqualified - Webpage is not readable",i),o}static async isCurrentWebPageReadable(){await initDcLocalStorage();if("true"===window.dcLocalStorage.getItem("bypassReadabilityEligibility"))return!0;if(null!==this.isReadable)return this.isReadable;const t=chrome.runtime.getURL("resources/SidePanel/sidePanelUtil.js"),{isProbablyFirefoxReaderable:e}=await import(t);return this.isReadable=await e(document,document.URL),this.isReadable}static async shouldShowTouchpoints(){return null!==this.shouldShow||(this.shouldShow=await this._shouldShowTouchpoints()),this.shouldShow}static async shouldDisableTouchpoints(){return!1}}